# ════════════════════════════════════════════════════════════════════════════════
# Upstream Service Definitions
# ════════════════════════════════════════════════════════════════════════════════

# API Service
upstream api_service {
    least_conn;
    server api_service:8000 max_fails=3 fail_timeout=30s;
    keepalive 32;
}

# Bot Service (for webhook mode)
upstream bot_service {
    server bot_service:8000 max_fails=3 fail_timeout=30s;
    keepalive 16;
}

# PostgreSQL Data Service (direct access for admin/debugging)
upstream db_postgres_service {
    server db_postgres_service:8000 max_fails=3 fail_timeout=30s;
    keepalive 16;
}

# MongoDB Data Service (direct access for admin/debugging)
upstream db_mongo_service {
    server db_mongo_service:8000 max_fails=3 fail_timeout=30s;
    keepalive 16;
}

# RabbitMQ Management (optional)
upstream rabbitmq_management {
    server rabbitmq:15672;
}

# Prometheus (monitoring)
upstream prometheus {
    server prometheus:9090;
}

# Grafana (monitoring)
upstream grafana {
    server grafana:3000;
}
